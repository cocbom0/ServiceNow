<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="catalog_script_client">
    <catalog_script_client action="INSERT_OR_UPDATE">
        <active>true</active>
        <applies_catalog>true</applies_catalog>
        <applies_extended>false</applies_extended>
        <applies_req_item>false</applies_req_item>
        <applies_sc_task>false</applies_sc_task>
        <applies_target_record>false</applies_target_record>
        <applies_to>item</applies_to>
        <cat_item display_value="Knowledge Articles (internal)">7423f8a31ba01110191cd8f99a4bcb2c</cat_item>
        <cat_variable/>
        <condition/>
        <description/>
        <field/>
        <global>true</global>
        <isolate_script>false</isolate_script>
        <messages/>
        <name>onSubmit : Has attachment - display_atta</name>
        <order/>
        <script><![CDATA[var attachmentAndTextManagementComplete = false;
var versionManagementComplete = false;

function onSubmit() {
    if (g_form.ajaxComplete) {
        return true;
    }
    attachmentAndTextManagement();
    versionManagement();
    return false;
}

function complete(processNumber) {
    switch (processNumber) {
        case 1:
            attachmentAndTextManagementComplete = true;
            break;
        case 2:
            versionManagementComplete = true;
            break;
        default:
            break;
    }

    if (attachmentAndTextManagementComplete && versionManagementComplete) {
        g_form.ajaxComplete = true;
        g_form.submit();
    }
}

function attachmentAndTextManagement() {
    if (this.document.getElementsByClassName('get-attachment').length !== 0) {
        g_form.setValue("display_attachments", "Yes");
        textManagement();
    } else {
        g_form.setValue("display_attachments", "No");
        complete(1);
    }
}

function textManagement() {
    var ga = "";
    ga = new GlideAjax("GetLastAttachmentSysIdByUser");
    ga.addParam("sysparm_name", "getAttachmentSysId");
    ga.addParam("user", g_user.userName);
    ga.getXMLAnswer(setText);
}

function setText(response) {
    var result = "";
    if (response) {
        result = JSON.parse(response);
        g_form.setValue("text", "<iframe width=\"960\" height=\"540\" src=\"" + getEnvironnment() + "$viewer.do?sysparm_stack=no&sysparm_sys_id=" + result.sys_id + "\"></iframe>");
    } else {
        g_form.setValue("text", "");
    }
    complete(1);
}

function versionManagement() {
    var ga = "";
    var article = g_form.getValue("article");

    if (article) {
        ga = new GlideAjax("CreateNewArticleVersion");
        ga.addParam("sysparm_name", "createArticleVersion");
        ga.addParam("article", article);
        ga.addParam("user", g_user.userName);
        ga.addParam("version", g_form.getValue("version"));
        ga.getXMLAnswer(setVersion);
    } else {
        complete(2);
    }
}

function setVersion(response) {
    var result = "";
    if (response) {
        result = JSON.parse(response);
        g_form.setValue("version", result.version);
    } else {
        g_form.setValue("version", "");
    }
    complete(2);
}

function getEnvironnment() {
    var result = "";

    var pattern = "^(https:\/\/liebherr)([a-z]*)(\.service-now\.com\/)";
    var regex = new RegExp(pattern);
    var results = regex.exec(top.location.href);

    if (results !== null) {
        result = results[1] + results[2] + results[3];
    }

    return result;
}]]></script>
        <sys_class_name>catalog_script_client</sys_class_name>
        <sys_created_by>cockrl0</sys_created_by>
        <sys_created_on>2022-07-13 13:07:49</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>1d23f8a31ba01110191cd8f99a4bcbbf</sys_id>
        <sys_mod_count>80</sys_mod_count>
        <sys_name>onSubmit : Has attachment - display_atta</sys_name>
        <sys_overrides/>
        <sys_package display_value="Support case" source="x_liisa_support_ca">80d47c06dba7f05001eafad3f3961926</sys_package>
        <sys_policy/>
        <sys_scope display_value="Support case">80d47c06dba7f05001eafad3f3961926</sys_scope>
        <sys_update_name>catalog_script_client_1d23f8a31ba01110191cd8f99a4bcbbf</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2023-04-04 15:02:52</sys_updated_on>
        <table/>
        <type>onSubmit</type>
        <ui_type>10</ui_type>
        <variable_set/>
        <view/>
    </catalog_script_client>
</record_update>
