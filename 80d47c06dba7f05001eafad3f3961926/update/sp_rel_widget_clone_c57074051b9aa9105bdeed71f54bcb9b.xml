<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_rel_widget_clone">
    <sp_rel_widget_clone action="INSERT_OR_UPDATE">
        <child display_value="LH knowledge Tags Facet">4d7078411b9aa9105bdeed71f54bcb90</child>
        <cloned>2023-04-17 14:32:16</cloned>
        <last_validated>2023-04-17 14:32:16</last_validated>
        <parent display_value="knowledge Tags Facet">c315f09adb00320099f93691f0b8f538</parent>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;sp_widget&gt;&lt;category/&gt;&lt;client_script&gt;&lt;![CDATA[function($scope,$rootScope,$compile,$timeout,KnowledgeSearchService,$filter) {
	/* widget controller */
	var c = this;
	c.data = c.data;
	c.showRange = c.options.min_scroll_count;
	c.options.title = c.options.title || "${Filter}";
	c.options.instanceid = c.data.instanceid;
	c.visible = false;
	c.clear = false;
	c.kind = "variable";
	c.type = "single_select";
	c.name = "tags";
	c.showQuery = false;
	c.enableSearch = false;
	c.gotoserver = true;
	c.selected = "";
	c.disableFilter = false;
	c.filteredItems = [];
	c.items = [];

	if($rootScope.isMobile){
		c.collapse = true;
	}else{
		c.collapse = false;
	}
	var input = {};
	input.name = c.name;
	input.element = "facet";
	input.kind = c.kind;
	input.type = c.type;
	input.table = 'label_entry';
	input.orderby = '';
	input.aggregate_query = c.options.aggregate_query;
	input.alt_url_params = c.options.alt_url_params;

	//Subscribe itself to search service on load
	KnowledgeSearchService.subscribe(input);

	var kbTagRefreshFacet = $rootScope.$on('sp.kb.refresh.facet',function(event,data){
		if(data &amp;&amp; data[c.name] &amp;&amp; data[c.name].length &gt; 0){
			//do not update the data if the event is generated by same facet
			if(KnowledgeSearchService.canUpdateFacet(c.name,c.items,data[c.name])){
				c.items = data[c.name];
				c.query = "";
			}else{
				c.items = KnowledgeSearchService.setSelections(c.items,data[c.name]);
			}
			c.visible = true;
		}else{

			//hide facet if no data
			c.visible = false;
			c.items = [];
			c.selection = "";
			c.query = "";
		}

		if(data &amp;&amp; c.data.facet_depth &lt; data.meta.article_count){
			c.showQuery = true;
			c.gotoserver = true;
		}else{
			c.gotoserver = false;
		}
	});

	$scope.$watch("c.query",_.debounce(function(event){
		if(c.enableSearch &amp;&amp; c.gotoserver){
			c.getMoreData();
		}else if(c.enableSearch){
			c.notifyResultUser(c.filteredItems);
		}
	},500));

	//Get more results for facet
	c.getMoreData = function(){
		c.disableFilter = true;
		var input = KnowledgeSearchService.getAppliedFilters();
		input.name = c.name;
		input.value = c.query;
		c.server.get(input).then(function(r) {
			if(r.data &amp;&amp; r.data.result &amp;&amp; r.data.result[c.name]){
				c.items = r.data.result[c.name];
				c.showQuery= true;
				c.gotoserver = true;

				if(c.query == "" &amp;&amp; (c.data.facet_depth - 10) &gt; c.items.length){
					c.gotoserver = false;
					c.disableFilter = false;
				}
				c.notifyResultUser(c.items);
			}
		});
	};

	c.notifyResultUser = function(resultLength){
		if(resultLength.length == 0)
			c.notity_noresults = "No results found for your search. Clear text to get all results";
		else
			c.notity_noresults = resultLength.length+ " " + "results found for your search.";
		$timeout(function(){
			$scope.$apply();
		});
	};

	var kbTagRefreshFacetSelection = $rootScope.$on("sp.kb.refresh.facet.selection",function(event,data){
		if(data &amp;&amp; data[c.name] &amp;&amp; data[c.name] == 'selected'){
			c.clear = true;
		}else{
			c.clear = false;
		}
	});

	//Watch clear link to clear all selections 
	$scope.$watch('c.clear',function(val){
		if(!val){
			c.items.forEach(function(item){
				item.selected = false; 
			});
		}
	});

	c.rowClick = function(item){
		c.items.forEach(function(item1){
			item1.selected = false; 
		});
		item.selected = true;
		c.updateKbFilterData(item);
	}

	//throw event for change in selection
	c.updateKbFilterData =function(item){
		item.selected = true;
		var data = {};
		data.name = c.name;
		data.type = c.type;
		data.label = item.label;
		data.id = item.id;
		$rootScope.$emit('sp.kb.updated.facet',data);
	};

	c.clearSelections = function(event){
		event.stopPropagation();
		c.clear = false;
		$rootScope.$emit("sp.kb.updated.facet.selection",{"name":c.name});
		/*Only keyboard navigation*/
		if(event.key)
			$('#f_header_'+c.data.instanceid).focus();
	};
	
	c.getFilteredMobileItems = function() {
		var filtered = $filter('filter') (c.items, {'label' : c.query});
		c.filteredItems = $filter('orderBy') (filtered, c.orderby);
		return c.filteredItems;
	}
	
	c.getFilteredItems = function() {
		var filtered = $filter('filter') (c.items, (!c.disableFilter || '') &amp;&amp; {'label':c.query})
		c.filteredItems = $filter('orderBy') (filtered, 'label');
		return c.filteredItems;
	}

	$scope.$on('$destroy',function(){
		kbTagRefreshFacetSelection();
		kbTagRefreshFacet();
	});
}]]&gt;&lt;/client_script&gt;&lt;controller_as&gt;c&lt;/controller_as&gt;&lt;css&gt;.panel{
  border-radius: 0 0 0 0;
  border: 1px solid #DDDDDD;
  border-top: 0px;
  margin-bottom: 0px;
}
.panel-heading{
  margin-bottom:0px;
  padding:8px 15px;
}
.panel-title{
  color: #3A3F51;
  font-size: 13px;
  font-weight: 600;
  a{
    color: #3A3F51;
  }
}
.remove-bottom-border{
  border-bottom:0px;
}
.float-left{
  float:right;
}
.toggle-icon{
  font-size: 18px;
  display:inline-flex;
  margin-top: 3px;
}
.clear-all{
  z-index:100;
  position: absolute;
  padding-right: 10px;
  right: 45px;
}
.invalid-field{
  color:$brand-danger;
  padding: 0 15px;
  padding-bottom:10px; 
}
.kb-facet-filter-block{
  line-height: 1.5;
}
.facet-search{
  padding: 10px; 
  border-bottom: 1px solid #DDDDDD;
}
.form-control{
  height:24px;
}
.facet-template{
  overflow: hidden;
}
.facet-field-padding{
  padding: 2px 0 0 15px;
}
.facet-scroll{
  overflow-y: auto; 
}
.checkbox{
  margin-top:0;
  margin-bottom:0;
}
.check-icon{
  color:$link-color;
}
.facet-dropdown{
  margin-right:15px; 
}
ul ,li{
  list-style:none; 
}
li{
  position: relative;
  padding: 2px 0px;
  background-color: #fff;
}
ul{
  margin: 0px 10px 0px -25px; 
}
.filter-groups{
  margin-bottom:20px; 
}
.facet-title{
  padding:10px 16px 0px 16px; 
}
.cat-facet-title{
  padding:10px 16px 0px 16px; 
  border-top:1px solid #eeeeee; 
}
.rating-stars{
  font-size: 11px; 
}
.glyphicon-star:before{
  color: #ffca1f;
}
.glyphicon-star-empty{
  color: #BDC0C4;
}
a.active,.checkbox-label.active{
  color:#000;
}
a:hover,a:focus,.checkbox-label:hover,.checkbox-label:focus{
  color:#000;
}
.show-this{
  display : block !important;
}
.checkbox-label{
  color:$link-color;
}
.check-icon {
  display:none;
}
.float-right{
  float:right;
  padding-right: 7px;
}

input[type='text']{
  height: 24px;
}
.show-more {
  text-align: center;
  display: block;
  height: 40px;
  padding-top: 9px;
}
.kb-name-elips{
  display: -webkit-box;
  line-height: 1.4;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

.transparent-button{
  color:$text-color;
  background-color: transparent;
  background-repeat:no-repeat;
  border: none;
  cursor:pointer;
  overflow: ellipsis;
  outline:none;
}&lt;/css&gt;&lt;data_table&gt;sp_instance&lt;/data_table&gt;&lt;demo_data/&gt;&lt;description/&gt;&lt;docs/&gt;&lt;field_list&gt;title,glyph,order,color,css&lt;/field_list&gt;&lt;has_preview&gt;false&lt;/has_preview&gt;&lt;id&gt;kb-tags-facet&lt;/id&gt;&lt;internal&gt;false&lt;/internal&gt;&lt;link&gt;&lt;![CDATA[function(scope) {	
	var c = scope.c;
	
	c.bindFunctions = function(){
		var collapseIconId = "collapse_icon_"+c.data.instanceid;
		$('#collapse_'+c.data.instanceid).on('shown.bs.collapse', function(){
			$("#"+collapseIconId).removeClass( "fa-plus-square-o" ).addClass( "fa-minus-square-o" );
			$('#panel_'+c.data.instanceid).removeClass("remove-bottom-border");
		});
		$('#collapse_'+c.data.instanceid).on('hidden.bs.collapse', function(){
			$("#"+collapseIconId).removeClass( "fa-minus-square-o" ).addClass( "fa-plus-square-o" );
			$('#panel_'+c.data.instanceid).addClass("remove-bottom-border");
		});
	}
	
	setTimeout(function(){
		c.bindFunctions();
	});
}]]&gt;&lt;/link&gt;&lt;name&gt;knowledge Tags Facet&lt;/name&gt;&lt;option_schema&gt;[{"hint":"Fetch maximum values (Limited to facet depth property) Enabling It may impact performance.","name":"aggregate","default_value":"false","label":"Fetch Maximum Values","type":"boolean"},{"hint":"Comma separated list of alternate URL parameters for this facet input (Default will be facet identifier)","name":"alt_url_params","label":"Alternate URL Parameters","type":"string"}]&lt;/option_schema&gt;&lt;public&gt;true&lt;/public&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[(function() {
	if(!input){
		//set instance sys_id to be used as unique id for collapse
		data.instanceid = $sp.getDisplayValue('sys_id');
		options.aggregate_query = options.aggregate_query ? options.aggregate_query == 'true' : false;
		options.alt_url_params = options.alt_url_params || "";
		options.min_scroll_count = options.min_scroll_count ? parseInt(options.min_scroll_count) : 10;
		data.messages = {};

		data.facet_depth = parseInt(gs.getProperty('glide.knowman.search.facet_depth') || 300);
		//aria labels
		data.messages.FILTER_LABEL = gs.getMessage("Filter");
		data.messages.OPTIONS_LABEL = gs.getMessage("options");
		data.messages.CLEAR_LABEL = gs.getMessage("Clear");
	}else{
		if(input){
			var result = {};
			var facetService = new KBPortalService();
			result = facetService.getFacetByName(
				input.name,
				input.value,
				input.keyword,
				input.language,
				input.variables,
				input.query,
				input.order
			);
			data.result = result;
		}
	}
})();]]&gt;&lt;/script&gt;&lt;servicenow&gt;true&lt;/servicenow&gt;&lt;sys_class_name&gt;sp_widget&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2017-01-03 09:41:03&lt;/sys_created_on&gt;&lt;sys_id&gt;c315f09adb00320099f93691f0b8f538&lt;/sys_id&gt;&lt;sys_mod_count&gt;25&lt;/sys_mod_count&gt;&lt;sys_name&gt;knowledge Tags Facet&lt;/sys_name&gt;&lt;sys_package display_value="Knowledge Management - Service Portal" source="sn_km_portal"&gt;bab6dea3db20320099f93691f0b8f590&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="Knowledge Management - Service Portal"&gt;bab6dea3db20320099f93691f0b8f590&lt;/sys_scope&gt;&lt;sys_update_name&gt;sp_widget_c315f09adb00320099f93691f0b8f538&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2022-05-20 14:39:53&lt;/sys_updated_on&gt;&lt;template&gt;&lt;![CDATA[&lt;div ng-show="c.visible"&gt;
  &lt;div class="kb-facet-block_{{::options.instanceid}} hidden-xs hidden-sm" ng-class="$root.showFacet &amp;&amp; !$root.showLanguageFacet ? 'show-this': '' "&gt;
    &lt;span aria-live="assertive" class="sr-only ng-binding" role="alert"&gt;{{c.notity_noresults}}&lt;/span&gt;
    &lt;div class="panel panel-{{::options.color}}" id="panel_{{::data.instanceid}}" ng-class="{'remove-bottom-border':c.collapse}"&gt;
      &lt;div class="panel-heading" data-toggle="collapse" data-target="#collapse_{{::data.instanceid}}" &gt;
        &lt;span class="panel-title"&gt;
          &lt;button class="transparent-button"id="f_header_{{::data.instanceid}}" aria-label="{{::options.title}} {{data.messages.FILTER_LABEL}} {{data.messages.OPTIONS_LABEL}}" data-toggle="collapse" data-target="#collapse_{{::data.instanceid}}"&gt;
            &lt;span ng-if="::options.glyph"&gt;&lt;fa name="{{::options.glyph}}" /&gt;
            &lt;/span&gt;&lt;span ng-bind="::options.title"&gt;&lt;/span&gt;
          &lt;/button&gt;
        &lt;/span&gt;
        &lt;span class="float-left"&gt;
          &lt;button class="clear-all transparent-button" ng-show="c.clear" ng-click="c.clearSelections($event)" ng-keypress="c.clearSelections($event)" aria-label="${Clear {{::options.title}} {{data.messages.FILTER_LABEL}}}"&gt;${Clear}&lt;/button&gt;
          &lt;span class="toggle-icon"&gt;&lt;i class="fa" id="collapse_icon_{{::data.instanceid}}" ng-class="{'fa-minus-square-o':!c.collapse,'fa-plus-square-o':c.collapse}" aria-hidden="true"&gt;&lt;/i&gt;&lt;/span&gt;
        &lt;/span&gt;
      &lt;/div&gt;
      &lt;div class="collapse" ng-class="::{'in':!$root.isMobile}" id="collapse_{{::data.instanceid}}"&gt;
        &lt;div class="facet-template"&gt;
          &lt;div class="kb-facet-filter-block"&gt;
            &lt;div class="facet-search hidden-xs hidden-sm" ng-if="c.showQuery || c.items.length &gt;10"&gt;
              &lt;input ng-keyup="c.enableSearch = true" name="facet-search" aria-label="${Filter} {{c.options.title}}" ng-model="c.query" type="text" class="form-control" placeholder="${Filter}" aria-invalid="false"&gt;
            &lt;/div&gt;
            &lt;div class="facet-detail" ng-class="{'facet-scroll':c.items.length &gt; c.options.min_scroll_count}" ng-if="c.items"&gt;
              &lt;div class="hidden-xs hidden-sm"&gt;
                &lt;div class="facet-field-padding" ng-repeat="item in c.getFilteredItems() track by item.id"&gt;
                  &lt;span ng-if="item.id"&gt;
                    &lt;a href="javascript:void(0);" ng-click="c.updateKbFilterData(item)" ng-class="{'active':item.selected}"&gt;${{{::item.label}}}&lt;/a&gt;
                  &lt;/span&gt;
                &lt;/div&gt;
              &lt;/div&gt;
              &lt;div class="visible-sm visible-xs"&gt;
                &lt;div class="facet-field-padding" ng-click="c.rowClick(item)"  ng-repeat="item in c.getFilteredMobileItems() track by item.id" ng-if="$index+1&lt;=c.showRange"&gt;
                  &lt;span ng-if="item.id"&gt;
                    &lt;a href="javascript:void(0);"  ng-class="item.selected ? 'active' : '' "&gt;${{{::item.label}}}&lt;/a&gt;
                    &lt;span class="check-icon" ng-show="item.selected"&gt;
                      &lt;i class="fa fa-check float-left"  aria-hidden="true"&gt;&lt;/i&gt;
                    &lt;/span&gt;
                  &lt;/span&gt;
                &lt;/div&gt;
                &lt;span ng-if="c.items.length &gt;c.options.min_scroll_count"&gt;
                  &lt;span class="show-more"  ng-show="c.showRange == c.options.min_scroll_count" ng-click="c.showRange = c.items.length"&gt;${Show More}&lt;/span&gt;
                  &lt;span class="show-more"  ng-show="c.showRange != c.options.min_scroll_count" ng-click="c.showRange = c.options.min_scroll_count"&gt;${Show Less}&lt;/span&gt; 
                &lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;style&gt;
    /*
    * Note: @media only screen doesnt work appropriately, when placed in css secion.
    * Considered, html {font-size:10px}
    */
    @media only screen and (max-width: 991px) {
      .kb-facet-block_{{::options.instanceid}}  .facet-field-padding {
        padding: 0.9rem 0 0 1.5rem;
        border-bottom : 0.1rem solid #DDDDDD;
        min-height : 4rem;
      }
    }
    @media only screen and (max-width: 991px) {
      .kb-facet-block_{{::options.instanceid}}  .check-icon {
        float : right;
        font-size: 1.8rem;
        display: inline-flex;
        padding-right : 1.5rem;
        padding-top : 0.2rem;
        display:block;
      }

    }
    @media only screen and (min-width: 991px) { 
      .kb-facet-block_{{::options.instanceid}}  .facet-detail{
        max-height: 21.5rem; 
        padding-top : 0.5rem;
        padding-bottom : 0.5rem;
      }

    }
  &lt;/style&gt;]]&gt;&lt;/template&gt;&lt;/sp_widget&gt;</payload>
        <sys_class_name>sp_rel_widget_clone</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2023-04-17 14:32:16</sys_created_on>
        <sys_id>c57074051b9aa9105bdeed71f54bcb9b</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>4d7078411b9aa9105bdeed71f54bcb90</sys_name>
        <sys_package display_value="Support case" source="x_liisa_support_ca">80d47c06dba7f05001eafad3f3961926</sys_package>
        <sys_policy/>
        <sys_scope display_value="Support case">80d47c06dba7f05001eafad3f3961926</sys_scope>
        <sys_update_name>sp_rel_widget_clone_c57074051b9aa9105bdeed71f54bcb9b</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2023-04-17 14:32:16</sys_updated_on>
    </sp_rel_widget_clone>
</record_update>
